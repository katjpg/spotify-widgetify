<svg width="495" height="160" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <foreignObject width="495" height="160">
      <div xmlns="http://www.w3.org/1999/xhtml" class="container">
        <style>
          /* CSS Reset */
          div, span, h1, p, a, img {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
            box-sizing: border-box;
          }
          a { text-decoration: none; }
          
          /* Main Widget Container */
          main {
            display: flex;
            padding: {{ css.container_padding }};
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            height: 120px;
            width: 440px;
          }
          
          /* Background with blur effect */
          .background-blur {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/png;base64,{{ base_64_track_image }}");
            background-size: cover;
            background-position: center;
            filter: blur(30px);
            opacity: 0.35;
            z-index: -1;
          }
          
          .background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: {{ css.overlay_color }};
            z-index: -1;
          }
          
          /* Content Container */
          aside {
            width: 100%;
            display: flex;
            position: relative;
          }
          
          /* Album Cover */
          .cover {
            width: 120px;
            height: 120px;
            border-radius: {{ css.album_border_radius }};
            {% if spin %}animation: spin 10s linear infinite;{% endif %}
          }
          
          /* Info Section */
          section {
            flex: 1;
            padding-left: 20px;
            display: flex;
            flex-direction: column;
          }
          
          /* Container for both track info and equalizer */
          .content-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            flex: 1;
          }
          
          /* Track Info */
          .track-info {
            font-family: {{ css.text_font }};
            max-width: 164px;
            margin-bottom: -36px;
          }
          
          /* Song Title */
          .track-name {
            font-size: 20px;
            font-weight: 500;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            color: {{ css.title_color }};
            margin-bottom: 4px;
          }
          
          /* Artist Name */
          .track-artist {
            font-size: 14px;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            color: {{ css.subtitle_color }};
          }
          
          /* Header with logo */
          .header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
          }
          
          /* Spotify Logo */
          .logo {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            filter: brightness(0) invert(1); /* Make logo white */
          }
          
          .now-playing {
            font-family: {{ css.text_font }};
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
          }
          
          /* Improved Equalizer */
          {% if show_equalizer %}
          .equalizer {
            display: inline-flex;
            align-items: center;
            height: 50px;
            gap: 6px;
            margin-right: 10px;
            margin-bottom: -42px;
          }
          
          .bar {
            width: 4px;
            height: 8px; /* Default height */
            border-radius: 50px;
            background: white;
            transform-origin: center;
            animation: bidirectionalWave 1.5s ease-in-out infinite;
          }
          
          @keyframes bidirectionalWave {
            0%, 100% {
              transform: scaleY(0.1);
            }
            50% {
              transform: scaleY(3.0);
            }
          }
          
          /* Create the wave pattern with animation delays */
          .bar:nth-child(1) { animation-delay: 1s; }
          .bar:nth-child(2) { animation-delay: 0.8s; }
          .bar:nth-child(3) { animation-delay: 0.6s; }
          .bar:nth-child(4) { animation-delay: 0.4s; }
          .bar:nth-child(5) { animation-delay: 0.2s; }
          .bar:nth-child(6) { animation-delay: 0.2s; }
          .bar:nth-child(7) { animation-delay: 0.4s; }
          .bar:nth-child(8) { animation-delay: 0.6s; }
          .bar:nth-child(9) { animation-delay: 0.8s; }
          .bar:nth-child(10) { animation-delay: 1s; }
          {% endif %}
          
          /* Animations */
          @keyframes spin {
            100% { transform: rotate(360deg); }
          }
        </style>
        
        <a href="https://open.spotify.com/track/{{ track_id }}" target="_blank">
          <main>
            <!-- Blurred background -->
            <div class="background-blur"></div>
            <div class="background-overlay"></div>
            
            <aside>
              <img 
                class="cover" 
                src="data:image/png;base64,{{ base_64_track_image }}" 
                alt="{{ track_name }} by {{ track_artist }}"
              />
              
              <section>
                <!-- Header with Now Playing text and Spotify logo -->
                <div class="header">
                  <img class="logo" src="data:image/svg+xml;base64,{{ logo }}" alt="Spotify"/>
                  <div class="now-playing">Now Playing</div>
                </div>
                
                <div class="content-wrapper">
                  <div class="track-info">
                    <div class="track-name">{{ track_name }}</div>
                    <div class="track-artist">{{ track_artist }}</div>
                  </div>
                  
                  {% if show_equalizer %}
                  <div class="equalizer">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                  </div>
                  {% endif %}
                </div>
              </section>
            </aside>
          </main>
        </a>
      </div>
    </foreignObject>
  </svg>